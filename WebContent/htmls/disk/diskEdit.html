<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>硬盘详情</title>
<link rel="stylesheet" href="../../layui/css/layui.css">
<script src="../../js/jquery-2.1.4.js"></script>
<script src="../../layui/layui.js"></script>
</head>
<body>
	<div style="padding: 15px 15px 0px 15px;">
		<form class="layui-form layui-form-pane" action="">
			<div class="layui-form-item">
				<label class="layui-form-label">硬盘名</label>
				<div class="layui-input-block">
					<input name="disk_name" lay-verify="disk_name" id="disk_name"
						autocomplete="off" class="layui-input" type="text">
				</div>
			</div>
			<div class="layui-form-item">
				<div class="layui-inline">
					<label class="layui-form-label">硬盘ID</label>
					<div class="layui-input-inline">
						<input name="disk_id" lay-verify="disk_id" id="disk_id"
							readonly="readonly" autocomplete="off" class="layui-input"
							type="text">
					</div>
				</div>
				<div class="layui-inline">
					<label class="layui-form-label">硬盘容量</label>
					<div class="layui-input-inline">
						<select name="disk_capacity" id="disk_capacity"
							lay-filter="disk_capacity">
							<option value="500G">500G</option>
							<option value="1T">1T</option>
							<option value="2T">2T</option>
							<option value="3T">3T</option>
							<option value="4T">4T</option>
							<option value="6T">6T</option>
							<option value="8T">8T</option>
						</select>
					</div>
				</div>
			</div>
			<div class="layui-form-item">
				<div class="layui-inline">
					<label class="layui-form-label">存储状态</label>
					<div class="layui-input-inline">
						<select name="is_full" id="is_full" lay-filter="is_full">
							<option value="已满">已满</option>
							<option value="未满">未满</option>
						</select>
					</div>
				</div>
				<div class="layui-inline">
					<label class="layui-form-label">硬盘状态</label>
					<div class="layui-input-inline">
						<select name="disk_state" id="disk_state" lay-filter="disk_state">
							<option value="现役">现役</option>
							<option value="退役">退役</option>
						</select>
					</div>
				</div>
			</div>
			<div class="layui-form-item">
				<div class="layui-inline">
					<label class="layui-form-label">创建时间</label>
					<div class="layui-input-inline">
						<input name="create_time" autocomplete="off" id="create_time"
							class="layui-input" type="text">
					</div>
				</div>
				<div class="layui-inline">
					<label class="layui-form-label">存储类型</label>
					<div class="layui-input-inline">
						<select name="video_type" id="video_type" lay-filter="video_type">
							<option value="动画" selected="selected">动画</option>
							<option value="电影">电影</option>
							<option value="剧">剧</option>
							<option value="纪录片">纪录片</option>
							<option value="网络视频">网络视频</option>
						</select>
					</div>
				</div>
			</div>
			<div class="layui-form-item layui-form-text">
				<label class="layui-form-label">备注</label>
				<div class="layui-input-block">
					<textarea id="remark" name="remark" class="layui-textarea"
						style="resize: none;"></textarea>
				</div>
			</div>
			<div class="layui-form-item">
				<button class="layui-btn" lay-submit="" lay-filter="submitButton">提交</button>
			</div>

		</form>
	</div>
</body>
<script> 
	layui.use([ 'form', 'layedit', 'laydate' ], function() {
		var form = layui.form;

		var disk_id = getUrlParam('disk_id');

		$.ajax({
			url : "/videoRecord/getDiskDetail/" + disk_id,
			method : "GET",
			dataType : "json",
			success : function(resp) {
				console.log(resp);
				if (resp.code == 0) {
					var jsonObj = resp.data;
					for ( var prop in jsonObj) {
						$("#" + prop).val(jsonObj[prop]);
					}
				} else {
					layer.alert("程序异常：" + resp.msg);
				}
			},
			error : function(xhr) {
				layer.alert("错误提示： " + xhr.status + " " + xhr.statusText);
			}
		});

		form.render('select'); //刷新select选择框渲染

		var layedit = layui.layedit;
		var laydate = layui.laydate;

		//日期
		laydate.render({
			elem : '#create_time',
			type : 'date'
		});

		//创建一个编辑器
		var editIndex = layedit.build('LAY_demo_editor');

		//监听提交
		form.on('submit(submitButton)', function(data) {
			var loadIndex = layer.load(1);
			console.log(JSON.stringify(data.field));
			$.ajax({
				url : "/videoRecord/diskEdit/",
				method : "POST",
				contentType : 'application/json',
				data : JSON.stringify(data.field),
				dataType : "json",
				success : function(resp) {
					layer.close(loadIndex);
					console.log(resp);
					if (resp.code == 0) {
						if (resp.data == 1) {
							layer.alert("编辑成功！！！", function() {
								var index = parent.layer
										.getFrameIndex(window.name);
								parent.tableIns.reload({});
								parent.layer.close(index);
							});
						} else {
							layer.alert("编辑失败，请核对数据！！！");
						}
					} else {
						layer.alert(resp.msg, {
							title : '程序异常：'
						})
					}
				},
				error : function(xhr) {
					layer.close(loadIndex);
					layer.alert(xhr.status + " " + xhr.statusText, {
						title : '系统异常：'
					})
				}
			});
			return false;
		});

	});

	//使用正则表达式获取url中的参数
	function getUrlParam(name) {
		//构造一个含有目标参数的正则表达式对象
		var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
		//匹配目标参数 
		var r = window.location.search.substr(1).match(reg);
		//返回参数值
		if (r != null)
			return unescape(r[2]);
		return null;
	}
</script>


</html>