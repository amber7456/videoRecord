<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1">
<link rel="stylesheet" href="../../layui/css/layui.css">
<link rel="stylesheet" href="../../css/animationAdvSearch.css?v=0309">
</head>
<body>
	<div style="padding: 15px;">
		<form class="layui-form layui-form-pane" id="advSearch"
			lay-filter="advSearch" style="width: 1100px;" action="">
			<div class="layui-form-item">
				<div class="layui-inline">
					<div class="layui-input-inline" style="width: 120px;">
						<input name="yearRange" id="yearRange" autocomplete="off"
							readonly="readonly" class="layui-input" type="text">
					</div>
				</div>
				<div class="layui-inline">
					<div class="layui-btn layui-btn-normal" lay-submit=""
						lay-filter="submitButton" onclick="search()">搜索</div>
				</div>
			</div>
		</form>
		<div id="trendChart"
			style="width: 90%; min-width: 800px; height: 600px;"></div>
		<!-- <div id="ratioChart" style="width: 800px; height: 800px;"></div> -->
	</div>
</body>
<script src="../../js/jquery-2.1.4.js"></script>
<script src="../../js/jquery.serializejson.js"></script>
<script src="../../js/echarts.js"></script>
<script src="../../layui/layui.js"></script>
<script>
	var myChart;
	var ratioChart;
	layui.use([ 'element', 'form', 'laydate', 'util' ], function() {
		var $ = layui.jquery;
		var element = layui.element;
		var laydate = layui.laydate;
		console.log("trend");

		//年范围
		var range = (new Date().getFullYear() - 6) + ' - '
				+ (new Date().getFullYear() - 1);
		laydate.render({
			elem : '#yearRange',
			type : 'year',
			value : range,
			theme : '#5FB878',
			btns : [ 'confirm' ],
			range : true
		});

		myChart = echarts.init(document.getElementById('trendChart'));
		// 		ratioChart = echarts.init(document.getElementById('ratioChart'));
		search();

	});

	function search() {
		var url = "/videoRecord/getTrend/";
		var method = "POST";
		var data = {
			yearRange : $("#yearRange").val(),
		};

		parent.sendRequest(url, method, data, function(resp) {
			console.log(resp);
			var yearArr;
			var fuyuArr;
			var haruArr;
			var natsuArr;
			var akiArr;
			var ovaArr;
			var egaArr;
			var otherArr;
			var totalArr;
			var baseArr;

			for (var i = 0; i < resp.data.dataList.length; i++) {
				if (resp.data.dataList[i].key == "yearArr") {
					yearArr = resp.data.dataList[i].arr;
				}
				if (resp.data.dataList[i].key == "fuyuArr") {
					fuyuArr = resp.data.dataList[i].arr;
				}
				if (resp.data.dataList[i].key == "haruArr") {
					haruArr = resp.data.dataList[i].arr;
				}
				if (resp.data.dataList[i].key == "natsuArr") {
					natsuArr = resp.data.dataList[i].arr;
				}
				if (resp.data.dataList[i].key == "akiArr") {
					akiArr = resp.data.dataList[i].arr;
				}
				if (resp.data.dataList[i].key == "ovaArr") {
					ovaArr = resp.data.dataList[i].arr;
				}
				if (resp.data.dataList[i].key == "egaArr") {
					egaArr = resp.data.dataList[i].arr;
				}
				if (resp.data.dataList[i].key == "otherArr") {
					otherArr = resp.data.dataList[i].arr;
				}
				if (resp.data.dataList[i].key == "totalArr") {
					totalArr = resp.data.dataList[i].arr;
				}
				if (resp.data.dataList[i].key == "baseArr") {
					baseArr = resp.data.dataList[i].arr;
				}
			}

			var labelOption = {
				normal : {
					show : true,
					position : 'bottom',
					color : '#000'
				}
			}
			//#67E0E3 #FF9F7F #96BFFF
			option = {
				title : {
					text : '趋势折线堆叠图'
				},
				color : [ '#01AAED', '#5FB878', '#FFB800', '#FF5722',
						'#2F4056', '#2F4056', '#2f4554', '#2F4056', '#2F4056',
						'#2F4056', '#749f83', '#ca8622', '#bda29a', '#6e7074',
						'#546570', '#c4ccd3' ],
				tooltip : {
					trigger : 'axis',
					axisPointer : {
						type : 'shadow'
					}
				},
				legend : {
					data : [ '冬番', '春番', '夏番', '秋番', '季番总量', '全年总量（含OVA，映画，其他）' ]
				// 'OVA/OAD', '映画', '其他',
				},
				toolbox : {
					feature : {
						saveAsImage : {}
					}
				},
				grid : {
					left : '3%',
					right : '4%',
					bottom : '3%',
					containLabel : true
				},
				xAxis : [ {
					type : 'category',
					/* boundaryGap : false, */
					data : yearArr
				} ],
				yAxis : [ {
					type : 'value',
					splitNumber : 10
				} ],
				series : [ {
					name : '冬番',
					type : 'line',
					label : labelOption,
					stack : '总量',
					areaStyle : {
						normal : {}
					},
					data : fuyuArr
				}, {
					name : '春番',
					type : 'line',
					label : labelOption,
					stack : '总量',
					areaStyle : {
						normal : {}
					},
					data : haruArr
				}, {
					name : '夏番',
					type : 'line',
					label : labelOption,
					stack : '总量',
					areaStyle : {
						normal : {}
					},
					data : natsuArr
				}, {
					name : '秋番',
					type : 'line',
					label : labelOption,
					stack : '总量',
					areaStyle : {
						normal : {}
					},
					data : akiArr
				}, {
					name : '季番总量',
					type : 'line',
					label : {
						normal : {
							show : true,
							position : 'top'
						}
					},
					data : baseArr
				}, {
					name : '全年总量（含OVA，映画，其他）',
					type : 'line',
					label : {
						normal : {
							show : true,
							position : 'top'
						}
					},
					data : totalArr
				} ]
			};
			// 使用刚指定的配置项和数据显示图表。
			myChart.setOption(option, true);

			// 			var dataJson = [];
			// 			for (var i = 0; i < yearArr.length; i++) {
			// 				var j = {};
			// 				j.value = baseArr[i];
			// 				j.name = yearArr[i];
			// 				console.log(yearArr[i]);
			// 				dataJson.push(j);
			// 			}

			// 			pieoption = {
			// 				title : {
			// 					text : '比例图',
			// 					subtext : '',
			// 					x : 'center'
			// 				},
			// 				//#67E0E3 #FF9F7F #96BFFF
			// 				color : [ '#01AAED', '#5FB878', '#FFB800', '#FF5722',
			// 						'#67E0E3', '#FF9F7F', '#96BFFF' ],
			// 				tooltip : {
			// 					trigger : 'item',
			// 					formatter : "{a} <br/>{b} : {c} ({d}%)"
			// 				},
			// 				legend : {
			// 					orient : 'vertical',
			// 					left : 'left',
			// 					data : yearArr
			// 				},
			// 				series : [ {
			// 					name : '访问来源',
			// 					type : 'pie',
			// 					radius : '75%',
			// 					center : [ '50%', '50%' ],
			// 					data : dataJson,
			// 					itemStyle : {
			// 						emphasis : {
			// 							shadowBlur : 10,
			// 							shadowOffsetX : 0,
			// 							shadowColor : 'rgba(0, 0, 0, 0.5)'
			// 						}
			// 					}
			// 				} ]
			// 			};
			// 			// 使用刚指定的配置项和数据显示图表。
			// 			ratioChart.setOption(pieoption, true);

		});

		// 		  {
		// 		name : 'OVA/OAD',
		// 		type : 'line',
		// 		stack : '总量',
		// 		areaStyle : {
		// 			normal : {}
		// 		},
		// 		data : ovaArr
		// 	}, {
		// 		name : '映画',
		// 		type : 'line',
		// 		stack : '总量',
		// 		areaStyle : {
		// 			normal : {}
		// 		},
		// 		data : egaArr
		// 	}, {
		// 		name : '其他',
		// 		type : 'line',
		// 		stack : '总量',
		// 		areaStyle : {
		// 			normal : {}
		// 		},
		// 		data : otherArr
		// 	},  

	}
 
</script>
</html>